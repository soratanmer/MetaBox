# sing-box 配置文件
# 本配置文件已按照 sing-box 1.12.0 及更高版本的特性进行重构和注释
# 请注意，sing-box 在 1.12.0 版本对 DNS 等部分进行了较大调整，配置格式可能与旧版本不兼容。

log:
  # 日志级别: info, warning, error, debug, trace
  level: info
  # 是否显示时间戳
  timestamp: true

experimental:
  # 实验性功能配置
  cache_file:
    # 是否启用缓存文件，用于存储 GeoIP/GeoSite 数据等
    enabled: true
  clash_api:
    # Clash API 兼容性配置
    # 外部控制器地址和端口，用于与 Clash Dashboard 等工具交互
    external_controller: 127.0.0.1:20123
    # API 密钥
    secret: accpetWYN
    # Clash API 的默认模式，rule (规则模式) 或 global (全局模式)
    default_mode: rule

dns:
  # DNS 配置部分
  servers:
    # 定义不同的 DNS 服务器
    - tag: remote-dns
      # 远程 DNS 服务器地址 (DoH)
      address: https://dns.google/dns-query
      # 用于解析此 DNS 服务器地址的解析器，指向下面定义的 resolver-dns
      address_resolver: remote-resolver-dns
      # 通过哪个出站连接此 DNS 服务器
      detour: 节点选择
    - tag: local-dns
      # 本地 DNS 服务器地址 (DoH)
      address: https://dns.alidns.com/dns-query
      # 用于解析此 DNS 服务器地址的解析器，指向下面定义的 resolver-dns
      address_resolver: resolver-dns
      # 通过哪个出站连接此 DNS 服务器
      detour: 全球直连
    - tag: resolver-dns
      # 用于解析 DoH/DoT 服务器地址的传统 DNS 服务器
      address: 223.5.5.5
      # 通过哪个出站连接此 DNS 服务器
      detour: 全球直连
    - tag: remote-resolver-dns
      # 用于解析 DoH/DoT 服务器地址的传统 DNS 服务器 (备用或远程)
      address: 8.8.8.8
      # 通过哪个出站连接此 DNS 服务器
      detour: 节点选择
    - tag: block
      # 用于拦截 DNS 请求的特殊 DNS 服务器
      address: rcode://success

  rules:
    # DNS 规则，按照顺序匹配，匹配到即停止
    - # 匹配所有出站流量的 DNS 请求，使用 local-dns 服务器，并禁用缓存
      # 在 1.12.0+ 中，出站匹配仍然在 DNS 规则中使用 'outbound' 字段
      outbound: any
      disable_cache: true
      server: local-dns
    - # 根据 Clash 模式匹配 DNS 请求 (Direct 模式使用 local-dns)
      clash_mode: direct
      server: local-dns
    - # 根据 Clash 模式匹配 DNS 请求 (Global 模式使用 remote-dns)
      clash_mode: global
      server: remote-dns
    - # 匹配 geosite_cn 规则集的域名，使用 local-dns
      rule_set: geosite_cn
      server: local-dns
    - # 匹配 geosite_geolocation-!cn 规则集的域名 (非中国大陆地理位置)，使用 remote-dns
      rule_set: geosite_geolocation-!cn
      server: remote-dns

  # FakeIP 配置
  fakeip:
    # 是否启用 FakeIP (通常用于 TUN 模式)
    enabled: false
    # IPv4 FakeIP 地址段
    inet4_range: 11.0.0.1/16
    # IPv6 FakeIP 地址段
    inet6_range: fc00::/18

  # 是否为每个 DNS 服务器使用独立的缓存 (true: 独立，false: 共享)
  independent_cache: false
  # 默认 DNS 服务器，如果没有规则匹配，则使用此服务器
  final: local-dns

inbounds:
  # 入站连接配置
  - type: mixed
    # 监听地址
    listen: 127.0.0.1
    # 监听端口
    listen_port: 20122
    # 是否启用协议嗅探，以识别连接的实际协议
    sniff: true
  - type: tun
    # TUN 设备的 IP 地址和子网掩码
    # 在 1.12.0+ 中，inet4_address 和 inet6_address 合并到 address 数组
    address:
      - 172.19.0.1/30
      - fdfe:dcba:9876::1/126
    # TUN 栈类型 (system 或 mixed)
    stack: system
    # 是否自动设置系统路由表
    auto_route: true
    # 是否强制 TUN 流量通过 sing-box 路由
    strict_route: true
    # 是否启用协议嗅探
    sniff: true
    # 平台特定配置
    platform:
      # HTTP 代理配置 (通常用于系统代理)
      http_proxy:
        # 是否启用
        enabled: true
        # 代理服务器地址
        server: 127.0.0.1
        # 代理服务器端口
        server_port: 20122

outbounds:
  # 出站连接配置
  - tag: 节点选择
    # 选择器类型，用于在多个出站中选择一个
    type: selector
    # 可供选择的出站列表
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 手动切换
      - direct
    # 默认选择的出站
    default: 日本节点
  - tag: 手动切换
    # 用于手动切换节点的选择器，初始为空
    type: selector
    outbounds: []
  # 以下是各个应用或服务特定的选择器出站
  - tag: Sina
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: Spotify
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: YouTube
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: 日本节点
  - tag: 哔哩哔哩
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: Telegram
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: 香港节点
  - tag: OpenAi
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: 美国节点
  - tag: FCM
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: Google
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: 日本节点
  - tag: Microsoft
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: Apple
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: 广告拦截
    type: selector
    outbounds:
      - block
      - direct
    # 注意：此处默认值未设置，请根据需要添加 default 字段
  - tag: 全球直连
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: direct
  - tag: 漏网之鱼
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 新加坡节点
      - 美国节点
      - 节点选择
      - 手动切换
      - direct
    default: 日本节点
  # 以下是用于测试节点可用性的 URLTest 出站
  - tag: 日本节点
    type: urltest
    outbounds: [] # 实际的节点出站需要填写在这里
    url: https://www.gstatic.com/generate_204
    interval: 300s
    tolerance: 150
  - tag: 香港节点
    type: urltest
    outbounds: [] # 实际的节点出站需要填写在这里
    url: https://www.gstatic.com/generate_204
    interval: 300s
    tolerance: 150
  - tag: 台湾节点
    type: urltest
    outbounds: [] # 实际的节点出站需要填写在这里
    url: https://www.gstatic.com/generate_204
    interval: 300s
    tolerance: 150
  - tag: 美国节点
    type: urltest
    outbounds: [] # 实际的节点出站需要填写在这里
    url: https://www.gstatic.com/generate_204
    interval: 300s
    tolerance: 150
  - tag: 新加坡节点
    type: urltest
    outbounds: [] # 实际的节点出站需要填写在这里
    url: https://www.gstatic.com/generate_204
    interval: 300s
    tolerance: 150
  # GLOBAL 选择器，用于全局模式
  - tag: GLOBAL
    type: selector
    outbounds:
      - 日本节点
      - 香港节点
      - 台湾节点
      - 美国节点
      - 新加坡节点
      - 节点选择
      - 手动切换
      - direct
      - block
    default: 日本节点
  # Direct 出站，直接连接，不使用代理
  - type: direct
    tag: direct
  # DNS 出站，用于发送 DNS 查询，通常配合 FakeIP 使用
  - type: dns
    tag: dns-out
  # Block 出站，用于阻止连接
  - type: block
    tag: block

route:
  # 路由配置
  rule_set:
    # 定义规则集，可以从本地文件或远程 URL 加载
    - tag: geosite_spotify
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/spotify.srs
      # 下载规则集时使用的出站
      download_detour: 全球直连
    - tag: geosite_telegram
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/telegram.srs
      download_detour: 全球直连
    - tag: geoip_telegram
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geoip/telegram.srs
      download_detour: 全球直连
    - tag: geosite_openai
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/openai.srs
      download_detour: 全球直连
    - tag: geosite_biliintl
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/biliintl.srs
      download_detour: 全球直连
    - tag: geosite_bilibili
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/bilibili.srs
      download_detour: 全球直连
    - tag: geosite_youtube
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/youtube.srs
      download_detour: 全球直连
    - tag: geosite_sina
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/sina.srs
      download_detour: 全球直连
    - tag: geoip_google
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geoip/google.srs
      download_detour: 全球直连
    - tag: geosite_google
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/google.srs
      download_detour: 全球直连
    - tag: geosite_microsoft
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/microsoft.srs
      download_detour: 全球直连
    - tag: geosite_apple
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/apple.srs
      download_detour: 全球直连
    - tag: geosite_googlefcm
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/googlefcm.srs
      download_detour: 全球直连
    - tag: geosite_category-ads-all
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/category-ads-all.srs
      download_detour: 全球直连
    - tag: geoip_cn
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geoip/cn.srs
      download_detour: 全球直连
    - tag: geosite_cn
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/cn.srs
      download_detour: 全球直连
    - tag: geosite_geolocation-!cn
      type: remote
      format: binary
      url: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/geolocation-!cn.srs
      download_detour: 全球直连

  rules:
    # 路由规则，按照顺序匹配，匹配到即停止
    - # 根据 Clash 模式匹配流量 (Direct 模式走 direct 出站)
      clash_mode: direct
      outbound: direct
    - # 根据 Clash 模式匹配流量 (Global 模式走 GLOBAL 选择器)
      clash_mode: global
      outbound: GLOBAL
    - # 匹配 geosite_spotify 规则集的流量，走 Spotify 选择器
      rule_set: geosite_spotify
      outbound: Spotify
    - # 匹配 geosite_telegram 或 geoip_telegram 规则集的流量，走 Telegram 选择器
      rule_set:
        - geosite_telegram
        - geoip_telegram
      outbound: Telegram
    - # 匹配 geosite_openai 规则集的流量，走 OpenAi 选择器
      rule_set: geosite_openai
      outbound: OpenAi
    - # 匹配 geosite_biliintl 或 geosite_bilibili 规则集的流量，走 哔哩哔哩 选择器
      rule_set:
        - geosite_biliintl
        - geosite_bilibili
      outbound: 哔哩哔哩
    - # 匹配 geosite_youtube 规则集的流量，走 YouTube 选择器
      rule_set: geosite_youtube
      outbound: YouTube
    - # 匹配 geosite_sina 规则集的流量，走 Sina 选择器
      rule_set: geosite_sina
      outbound: Sina
    - # 匹配 geoip_google 或 geosite_google 规则集的流量，走 Google 选择器
      rule_set:
        - geoip_google
        - geosite_google
      outbound: Google
    - # 匹配 geosite_microsoft 规则集的流量，走 Microsoft 选择器
      rule_set: geosite_microsoft
      outbound: Microsoft
    - # 匹配 geosite_apple 规则集的流量，走 Apple 选择器
      rule_set: geosite_apple
      outbound: Apple
    - # 匹配 geosite_googlefcm 规则集的流量，走 FCM 选择器
      rule_set: geosite_googlefcm
      outbound: FCM
    - # 匹配 geosite_category-ads-all 规则集的流量，走 广告拦截 选择器
      rule_set: geosite_category-ads-all
      outbound: 广告拦截
    - # 匹配 geoip_cn 或 geosite_cn 规则集的流量 (中国大陆)，走 全球直连 选择器
      rule_set:
        - geoip_cn
        - geosite_cn
      outbound: 全球直连
    - # 匹配 geosite_geolocation-!cn 规则集的流量 (非中国大陆)，走 节点选择 选择器
      rule_set: geosite_geolocation-!cn
      outbound: 节点选择

  # 最终匹配的出站，如果没有规则匹配，则使用此出站
  final: 漏网之鱼
  # 是否自动检测网络接口变化并更新路由
  auto_detect_interface: true